#### 1.1问题:有了HTTP为何还有RPC？
答：论复杂度，RPC框架肯定是高于简单的HTTP接口的。但毋庸置疑，HTTP接口由于受限于HTTP协议，
需要带HTTP请求头，导致传输起来效率或者说安全性不如RPC。
  
 下面展示了一个请求头，无用数据过多，响应头类似
 ```cassandraql
GET /search/suggest/initial_page/ HTTP/1.1
Host    www.toutiao.com
Content-Type    application/x-www-form-urlencoded
Accept-Encoding gzip, deflate
Cookie  CNZZDATA1259612802=569328305-1527816505-https%253A%252F%252Fwww.baidu.com%252F%7C1527821905; WEATHER_CITY=%E5%8C%97%E4%BA%AC; __tasessionId=i33ntavtt1527822487203; tt_webid=6561930712081466884; UM_distinctid=163b91509b88ff-0e1ee05ec87bae-3f636c4f-13c680-163b91509b96aa; _ga=GA1.2.195827442.1493809988; sso_login_status=0; tt_webid=6561930712081466884; uuid="w:b5453e80f63342d1afe07a5d3c3360f9"
Connection  keep-alive
Proxy-Connection    keep-alive
Accept  text/javascript, text/html, application/xml, text/xml, */*
User-Agent  Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/11.1 Safari/605.1.15
Referer https://www.toutiao.com/
Accept-Language zh-cn
X-Requested-With    XMLHttpRequest
``` 

优点：

http接口是在接口不多、系统与系统交互较少的情况下；优点就是简单、直接、开发方便。
利用现成的http协议进行传输。但是如果是一个大型的网站，内部子系统较多、接口非常多的情况下，
RPC框架的好处就显示出来了，首先就是长链接，不必每次通信都要像http 一样去3次握手什么的，
减少了网络开销；其次就是RPC框架一般都有注册中心，有丰富的监控管理；发布、下线接口、动态扩展等，
对调用方来说是无感知、统 一化的操作。

HTTP与RPC存在重大不同的是：请求是使用具有标准语义的通用的接口定向到资源的，
这些语义能够被中间组件和提供服务的来源机器进行解释。结果是使得一个应用支持分层的转换和间接层，
并且独立于消息的来源。

与之相比较，RPC的机制是根据语言的API来定义的，而不是根据基于网络的应用来定义的。

事实上，对于http,也可以作为RPC框架的通信层协议和实现。 
只不过，对于大部分企业成熟的RPC框架，使用thrift等工具可以实现二进制传输，
相比HTTP的文本传输无疑大大提高了传输效率; HTTP通常使用的json，一个需要用户序列化/反序列化，
性能和复杂度较高。相比之下，Thrift等工具，使用了成熟的代码生成技术，
将通信接口的文件生成了对应语言的代码接口，实现了远程调用接近于本地方法的调用。
另外无论是网络传输编码、解码，还是传输内容大小还是网络开销都想比HTTP有较大的优势。

一般rpc框架包括：服务查找，负载均衡，服务降级、熔断，下游路由配置，数据格式约定，
链接维护等几个方面。

#### 1.2问题:TCP、HTTP与Socket区别
##### 1.2.1 TCP连接
手机能够使用联网功能是因为手机底层实现了TCP/IP协议，可以使手机终端通过无线网络建立TCP连接。TCP协议可以对上层网络提供接口，使上层网络数据的传输建立在“无差别”的网络之上。

建立起一个TCP连接需要经过“三次握手”：
```cassandraql
第一次握手：客户端发送syn包(syn=j)到服务器，并进入SYN_SEND状态，等待服务器确认；

第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），
即SYN+ACK包，此时服务器进入SYN_RECV状态；

第三次握手：客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=k+1)，此包发送完毕，
客户端和服务器进入ESTABLISHED状态，完成三次握手。

握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。


理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连 接之前，
TCP 连接都将被一直保持下去。断开连接时服务器和客户端均可以主动发起断开TCP连接的请求，
断开过程需要经过“四次握手”（过程就不细写 了，就是服务器和客户端交互，最终确定断开）
```

##### 1.2.2 HTTP连接
HTTP协议即超文本传送协议(Hypertext Transfer Protocol )，
是Web联网的基础，也是手机联网常用的协议之一，HTTP协议是建立在TCP协议之上的一种应用。

http 为短连接：
```cassandraql
客户端发送请求都需要服务器端回送响应。请求结束后，主动释放链接，因此为短连接。
要保持客户端程序的在线状态，需要不断地向服务器发起连接请求。
通常的做法是即时不需要获得任何数据，客户端也保持每隔一段固定的时间
向服务器发送一次“保持连接”的请求，服务器在收到该请求后对客户端进行回复，表明知道客户端“在线”。
若服务器长时间无法收到客户端的请求，则认为客户端“下线”，
若客户端长时间无法收到服务器的回复，则认为网络已经断开。

TCP是底层通讯协议，定义的是数据传输和连接方式的规范 HTTP是应用层协议，定义的是传输数据的内容的规范。
http与tcp不是对等的两种协议，http是可以基于tcp传输的协议。
```

##### 1.2.3 Socket连接
**Socket为长连接：**
```
Socket 是对 TCP/IP 协议的封装，Socket 只是个接口不是协议，通过 Socket 我们去使用 TCP/IP 协议，除了 TCP，也可以使用 UDP 协议来传递数据。
```

Socket也称作套接字，套接字是通信的基石，是支持TCP/IP协议的网络通信的基本操作单元。
它是网络通信过程中端点的抽象表示。建立Socket连接至少需要一对套接字，其中一个运行于客户端，
称为ClientSocket ，另一个运行于服务器端，称为ServerSocket 。

套接字之间的连接过程分为三个步骤：服务器监听，客户端请求，连接确认。

**服务器监听：**
```
服务器端套接字并不定位具体的客户端套接字，而是处于等待连接的状态，实时监控网络状态，等待客户端的连接请求。
```

**客户端请求：**
```
指客户端的套接字提出连接请求，要连接的目标是服务器端的套接字。为此，
客户端的套接字必须首先描述它要连接的服务器的套接字，指出服务器端套接字的地址和端口号，
然后就向服务器端套接字提出连接请求。
```

**连接确认：**
```
当服务器端套接字监听到或者说接收到客户端套接字的连接请求时，就响应客户端套接字的请求，
建立一个新的线程，把服务器端套接字的描述发给客户 端，一旦客户端确认了此描述，
双方就正式建立连接。而服务器端套接字继续处于监听状态，继续接收其他客户端套接字的连接请求。
```

#### 1.3 总结
HTTP连接使用的是"请求-响应"方式，不仅在请求时才建立连接，而且客户端向服务器端请求后，服务器才返回数据。

创建 Socket 连接的时候，可以指定传输层协议，可以是 TCP 或者 UDP。通常情况下Socket 连接就是 TCP 连接，因此 Socket 连接一旦建立,通讯双方开始互发数据内容，直到双方断开连接。

很多情况下，都是需要服务器端向客户端主动推送数据，保持客户端与服务端的实时同步。

若双方是 Socket 连接，可以由服务器直接向客户端发送数据。

若双方是 HTTP 连接，则服务器需要等客户端发送请求后，才能将数据回传给客户端。

因此，客户端定时向服务器端发送请求，不仅可以保持在线，同时也询问服务器是否有新数据，如果有就将数据传给客户端。